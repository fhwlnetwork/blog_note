import{_ as e}from"./chunks/ArticleMetadata.Sb1DYAHo.js";import{_ as h,D as k,o as n,c as r,I as d,w as g,k as l,a as o,R as c,b as D,e as A}from"./chunks/framework.FVQzxbLi.js";import"./chunks/md5.RtphNWHi.js";const x=JSON.parse('{"title":"Docker容器监控之CAdvisor+InfluxDB+Granfana","description":"","frontmatter":{"title":"Docker容器监控之CAdvisor+InfluxDB+Granfana","author":"吴建华","date":"2022/10/22 21:25","categories":["docker高级篇"],"tags":["docker","Linux"]},"headers":[],"relativePath":"courses/cloud/02-docker高级篇/07-docker_cig.md","filePath":"courses/cloud/02-docker高级篇/07-docker_cig.md","lastUpdated":1702605175000}'),m={name:"courses/cloud/02-docker高级篇/07-docker_cig.md"},y=l("h1",{id:"docker容器监控之cadvisor-influxdb-granfana",tabindex:"-1"},[o("Docker容器监控之CAdvisor+InfluxDB+Granfana "),l("a",{class:"header-anchor",href:"#docker容器监控之cadvisor-influxdb-granfana","aria-label":'Permalink to "Docker容器监控之CAdvisor+InfluxDB+Granfana"'},"​")],-1),C=c(`<h2 id="是什么" tabindex="-1">是什么 <a class="header-anchor" href="#是什么" aria-label="Permalink to &quot;是什么&quot;">​</a></h2><p>CAdvisor监控收集+InfluxDB存储数据+Granfana展示图表</p><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/202202072039735.png" alt="image-20220207203936667"></p><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/202202072039975.png" alt="image-20220207203948907"></p><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/202202072040899.png" alt="image-20220207204017835"></p><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><h3 id="新建目录-创建文件" tabindex="-1">新建目录，创建文件 <a class="header-anchor" href="#新建目录-创建文件" aria-label="Permalink to &quot;新建目录，创建文件&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@wjh </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]# mkdir /mydocker/cig -p</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@wjh </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]# cd /mydocker/cig/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@wjh cig]# touch docker-compose.yml</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@wjh cig]# vim docker-compose.yml</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;3.1&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  grafana_data</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;"> influxdb</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">tutum/influxdb:0.9</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  restart</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  environment</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">PRE_CREATE_DB=cadvisor</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;8083:8083&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;8086:8086&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">./data/influxdb:/data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;"> cadvisor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">google/cadvisor</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  links</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">influxdb:influxsrv</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  command</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-storage_driver=influxdb -storage_driver_db=cadvisor -storage_driver_host=influxsrv:8086</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  restart</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;8080:8080&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/:/rootfs:ro</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/var/run:/var/run:rw</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/sys:/sys:ro</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/var/lib/docker/:/var/lib/docker:ro</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;"> grafana</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  user</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;104&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">grafana/grafana</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  user</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;104&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  restart</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  links</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">influxdb:influxsrv</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;3000:3000&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">grafana_data:/var/lib/grafana</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  environment</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">HTTP_USER=admin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">HTTP_PASS=admin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFLUXDB_HOST=influxsrv</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFLUXDB_PORT=8086</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFLUXDB_NAME=cadvisor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFLUXDB_USER=root</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFLUXDB_PASS=root</span></span></code></pre></div><h4 id="启动docker-compose文件" tabindex="-1">启动docker-compose文件 <a class="header-anchor" href="#启动docker-compose文件" aria-label="Permalink to &quot;启动docker-compose文件&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/202202072046424.png" alt="image-20220207204601333"></p><h3 id="浏览cadvisor收集服务-http-ip-8080" tabindex="-1">浏览cAdvisor收集服务，<a href="http://ip:8080/" target="_blank" rel="noreferrer">http://ip:8080/</a> <a class="header-anchor" href="#浏览cadvisor收集服务-http-ip-8080" aria-label="Permalink to &quot;浏览cAdvisor收集服务，http://ip:8080/&quot;">​</a></h3><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220208105214788.png" alt="image-20220208105214788"></p><h3 id="浏览influxdb存储服务-http-ip-8083" tabindex="-1">浏览influxdb存储服务，<a href="http://ip:8083/" target="_blank" rel="noreferrer">http://ip:8083/</a> <a class="header-anchor" href="#浏览influxdb存储服务-http-ip-8083" aria-label="Permalink to &quot;浏览influxdb存储服务，http://ip:8083/&quot;">​</a></h3><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220208105853184.png" alt="image-20220208105853184"></p><h3 id="浏览grafana展现服务-http-ip-3000" tabindex="-1">浏览grafana展现服务，<a href="http://ip:3000" target="_blank" rel="noreferrer">http://ip:3000</a> <a class="header-anchor" href="#浏览grafana展现服务-http-ip-3000" aria-label="Permalink to &quot;浏览grafana展现服务，http://ip:3000&quot;">​</a></h3><p>ip+3000端口的方式访问,默认帐户密码（admin/admin）</p><h4 id="配置步骤" tabindex="-1">配置步骤 <a class="header-anchor" href="#配置步骤" aria-label="Permalink to &quot;配置步骤&quot;">​</a></h4><p>1、配置数据源</p><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220208110034152.png" alt="image-20220208110034152"></p><p>2、选择influxdb数据源</p><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220208110112869.png" alt="image-20220208110112869"></p><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220208110212135.png" alt="image-20220208110212135"></p><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220208110334052.png" alt="image-20220208110334052"></p><p>3、配置面板panel</p><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220208111211233.png" alt="image-20220208111211233"></p><p>选择图表</p><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220208111355151.png" alt="image-20220208111355151"></p><p>配置数据</p><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220208111510209.png" alt="image-20220208111510209"></p><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220208111619065.png" alt="image-20220208111619065"></p><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220208112454038.png" alt="image-20220208112454038"></p>`,33);function F(s,u,B,f,_,v){const t=e,p=k("ClientOnly");return n(),r("div",null,[y,d(p,null,{default:g(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(n(),D(t,{key:0,article:s.$frontmatter},null,8,["article"])):A("",!0)]}),_:1}),C])}const q=h(m,[["render",F]]);export{x as __pageData,q as default};
