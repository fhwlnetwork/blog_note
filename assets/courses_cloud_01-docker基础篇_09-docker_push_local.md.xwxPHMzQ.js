import{_ as n}from"./chunks/ArticleMetadata.Sb1DYAHo.js";import{_ as p,D as k,o as t,c as r,I as o,w as d,k as e,a as c,R as g,b as u,e as F}from"./chunks/framework.FVQzxbLi.js";import"./chunks/md5.RtphNWHi.js";const j=JSON.parse('{"title":"推送镜像到本地","description":"","frontmatter":{"title":"推送镜像到本地","author":"吴建华","date":"2022/10/22 21:25","categories":["docker基础篇"],"tags":["docker","Linux"],"showArticleMetadata":false,"editLink":false,"lastUpdated":false,"showComment":false},"headers":[],"relativePath":"courses/cloud/01-docker基础篇/09-docker_push_local.md","filePath":"courses/cloud/01-docker基础篇/09-docker_push_local.md","lastUpdated":1702561947000}'),y={name:"courses/cloud/01-docker基础篇/09-docker_push_local.md"},C=e("h1",{id:"推送镜像到本地",tabindex:"-1"},[c("推送镜像到本地 "),e("a",{class:"header-anchor",href:"#推送镜像到本地","aria-label":'Permalink to "推送镜像到本地"'},"​")],-1),m=g(`<pre><code>## 下载镜像Docker Registry
</code></pre><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># docker pull registry</span></span></code></pre></div><pre><code>## 运行私有库Registry，相当于本地有个私有Docker hub
</code></pre><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5000</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:5000</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /zzyyuse/myregistry/:/tmp/registry</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --privileged=true</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> registry</span></span></code></pre></div><blockquote><p>默认情况，仓库被创建在容器的/var/lib/registry目录下，建议自行用容器卷映射，方便于宿主机联调</p></blockquote><h3 id="案例演示创建一个新镜像-ubuntu安装ifconfig命令" tabindex="-1">案例演示创建一个新镜像，ubuntu安装ifconfig命令 <a class="header-anchor" href="#案例演示创建一个新镜像-ubuntu安装ifconfig命令" aria-label="Permalink to &quot;案例演示创建一个新镜像，ubuntu安装ifconfig命令&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">apt-get</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> net-tools</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220204180753957.png" alt="image-20220204180753957"></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root@wjh:/home/wjh#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> commit</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -m=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;本地测试&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -a=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;wjh&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">dc642adb22e</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> wjhubuntu:1.1</span></span></code></pre></div><blockquote><p>命令： 在容器外执行，记得</p></blockquote><h3 id="curl验证私服库上有什么镜像" tabindex="-1">curl验证私服库上有什么镜像 <a class="header-anchor" href="#curl验证私服库上有什么镜像" aria-label="Permalink to &quot;curl验证私服库上有什么镜像&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root@wjh:/home/wjh#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -XGET</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> http://172.16.34.129:5000/v2/_catalog</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;repositories&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[]}</span></span></code></pre></div><h3 id="将新镜像zzyyubuntu-1-2修改符合私服规范的tag" tabindex="-1">将新镜像zzyyubuntu:1.2修改符合私服规范的Tag <a class="header-anchor" href="#将新镜像zzyyubuntu-1-2修改符合私服规范的tag" aria-label="Permalink to &quot;将新镜像zzyyubuntu:1.2修改符合私服规范的Tag&quot;">​</a></h3><p>按照公式： docker tag 镜像:Tag Host:Port/Repository:Tag</p><p>自己host主机IP地址，填写同学你们自己的，不要粘贴错误，O(∩_∩)O</p><p>使用命令 docker tag 将wjhbuntu:1.1这个镜像修改为172.16.34.129:5000/wjhubuntu:1.1</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root@wjh:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> wjhubuntu:1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.16</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.34.129:5000/wjhubuntu:1.1</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220204185452606.png" alt="image-20220204185452606"></p><h3 id="修改配置文件使之支持http" tabindex="-1">修改配置文件使之支持http <a class="header-anchor" href="#修改配置文件使之支持http" aria-label="Permalink to &quot;修改配置文件使之支持http&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root@wjh:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/docker/daemon.json</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;registry-mirrors&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;https://rcl1cdp5.mirror.aliyuncs.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;insecure-registries&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;172.16.34.129:5000&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><blockquote><p>上述理由：docker默认不允许http方式推送镜像，通过配置选项来取消这个限制。====&gt; 修改完后如果不生效，建议重启docker</p></blockquote><h3 id="push推送到私服库" tabindex="-1">push推送到私服库 <a class="header-anchor" href="#push推送到私服库" aria-label="Permalink to &quot;push推送到私服库&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root@wjh:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> push</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.16</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.34.129:5000/wjhubuntu:1.1</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220204190057767.png" alt="image-20220204190057767"></p><h3 id="curl验证私服库上有什么镜像2" tabindex="-1">curl验证私服库上有什么镜像2 <a class="header-anchor" href="#curl验证私服库上有什么镜像2" aria-label="Permalink to &quot;curl验证私服库上有什么镜像2&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root@wjh:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -XGET</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> http://172.16.34.129:5000/v2/_catalog</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;repositories&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;wjhubuntu&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">]}</span></span></code></pre></div><h3 id="pull到本地并运行" tabindex="-1">pull到本地并运行 <a class="header-anchor" href="#pull到本地并运行" aria-label="Permalink to &quot;pull到本地并运行&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root@wjh:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pull</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.16</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.34.129:5000/wjhubuntu:1.1</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/image-20220204190634581.png" alt="image-20220204190634581"></p>`,29);function b(s,D,v,_,q,f){const h=n,l=k("ClientOnly");return t(),r("div",null,[C,o(l,null,{default:d(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(t(),u(h,{key:0,article:s.$frontmatter},null,8,["article"])):F("",!0)]}),_:1}),m])}const E=p(y,[["render",b]]);export{j as __pageData,E as default};
